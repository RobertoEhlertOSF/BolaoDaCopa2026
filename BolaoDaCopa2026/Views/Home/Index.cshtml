@model List<BolaoDaCopa2026.Models.Jogo>

@{
    ViewData["Title"] = "Home";
    var agora = DateTime.Now;

    var proximoJogo = Model?
        .Where(j => j.DataHora > agora)
        .OrderBy(j => j.DataHora)
        .FirstOrDefault();
}

<section class="landing">
    <div class="landing_card">

        @* ✅ Admin “fora” do card (visual), mas ancorado no card (pra não quebrar layout) *@
        @if (Context.Session.GetString("IsAdmin")?.Equals("True", StringComparison.OrdinalIgnoreCase) == true)
        {
            <div class="admin-link-wrap">
                <a asp-controller="AdminJogos"
                   asp-action="Index"
                   class="admin-link">
                    Administrador
                </a>
            </div>
        }

        <h1>Bolão da Copa 2026</h1>

        @if (Model != null && Model.Any())
        {
            <div class="games-wrapper">
                @foreach (var jogo in Model)
                {
                    var emAndamento =
                    jogo.DataHora <= agora &&
                    jogo.Status == "EmAndamento";

                    <div class="game-card">
                        <div class="game-meta @(emAndamento ? "live" : "upcoming")">
                            <span class="status-text">
                                @(emAndamento
                                                        ? "Jogo em andamento"
                                                        : jogo.Status == "Finalizado"
                                                        ? "Jogo finalizado"
                                                        : "Próximo jogo")
                    </span>

                            <span class="divider">•</span>

                            <span class="datetime">
                                @jogo.DataHora.ToString("dd/MM • HH:mm")
                            </span>
                        </div>

                        <h2>@jogo.Fase</h2>

                        <div class="matchup">
                            <div class="team side-a">
                                <img src="@jogo.SelecaoA.BandeiraUrl"
                                     alt="@jogo.SelecaoA.Nome" />
                                <span class="team-name">@jogo.SelecaoA.Nome</span>
                            </div>

                            <div class="vs-badge">×</div>

                            <div class="team side-b">
                                <img src="@jogo.SelecaoB.BandeiraUrl"
                                     alt="@jogo.SelecaoB.Nome" />
                                <span class="team-name">@jogo.SelecaoB.Nome</span>
                            </div>
                        </div>

                @if (jogo.Status == "Finalizado")
                        {
                            <div class="resultado-final">
                                <strong>@jogo.GolsSelecaoA × @jogo.GolsSelecaoB</strong>
                            </div>
                        }
                    </div>
                }
            </div>

            @* ✅ Contador (abaixo da lista) *@
            @if (proximoJogo != null)
            {
                <div class="countdown"
                     data-date="@proximoJogo.DataHora.ToString("yyyy-MM-ddTHH:mm:ss")">
                    <div class="time-box">
                        <div class="time-value days">00</div>
                        <div class="time-label">Dias</div>
                    </div>
                    <div class="time-box">
                        <div class="time-value hours">00</div>
                        <div class="time-label">Horas</div>
                    </div>
                    <div class="time-box">
                        <div class="time-value minutes">00</div>
                        <div class="time-label">Min</div>
                    </div>
                    <div class="time-box">
                        <div class="time-value seconds">00</div>
                        <div class="time-label">Seg</div>
                    </div>
                </div>
            }
        }
        else
        {
            <p class="text-muted">
                Nenhum jogo agendado.
                O caos ainda está em preparação.
            </p>
        }

        <div class="actions">
            @using Microsoft.AspNetCore.Http

            @if (Context.Session.GetInt32("ApostadorId") == null)
            {
                <a class="btn-home btn-home--primary"
                   asp-controller="Conta"
                   asp-action="Login">
                    Entrar no Bolão
                </a>
            }
            else
            {
                <a href="/Apostas" class="btn-home btn-home--primary">
                    Minhas Apostas
                </a>

                <a asp-controller="Ranking" asp-action="Index" class="btn-home btn-home--primary">
                    Ranking
                </a>
            }
            <a href="/Selecoes" class="btn btn_secundario">
                Tabela da Copa
            </a>

            <a asp-controller="Home"
               asp-action="Regras"
               class="btn btn_secundario">
                 Regras do Bolão
            </a>

        </div>
    </div>

    @if (proximoJogo != null)
    {
        <script>
            function updateCountdowns() {
                document.querySelectorAll(".countdown").forEach(countdown => {
                    const targetDate = new Date(countdown.dataset.date).getTime();
                    const now = Date.now();
                    const diff = targetDate - now;

                    const daysEl = countdown.querySelector(".days");
                    const hoursEl = countdown.querySelector(".hours");
                    const minutesEl = countdown.querySelector(".minutes");
                    const secondsEl = countdown.querySelector(".seconds");

                    if (!daysEl || !hoursEl || !minutesEl || !secondsEl) return;

                    if (diff <= 0) {
                        daysEl.textContent =
                            hoursEl.textContent =
                            minutesEl.textContent =
                            secondsEl.textContent = "00";
                        return;
                    }

                    daysEl.textContent = String(Math.floor(diff / (1000 * 60 * 60 * 24))).padStart(2, "0");
                    hoursEl.textContent = String(Math.floor((diff / (1000 * 60 * 60)) % 24)).padStart(2, "0");
                    minutesEl.textContent = String(Math.floor((diff / (1000 * 60)) % 60)).padStart(2, "0");
                    secondsEl.textContent = String(Math.floor((diff / 1000) % 60)).padStart(2, "0");
                });
            }

            updateCountdowns();
            setInterval(updateCountdowns, 1000);
        </script>
    }
</section>

<style>
    /* ✅ garante que o admin absoluto “use” o card como referência */
    .landing_card {
        position: relative;
        overflow: visible;
    }

    /* ✅ Admin: fica “fora” do card (top negativo), mas preso no card */
    .admin-link-wrap {
        position: absolute;
        top: -48px;
        left: 0px;
        z-index: 999;
    }

    .admin-link {
        color: rgba(255,255,255,0.78);
        text-decoration: none;
        font-weight: 700;
        padding: 10px 14px;
        border-radius: 12px;
        background: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.12);
        backdrop-filter: blur(8px);
        transition: filter .2s ease, transform .1s ease, background .2s ease;
    }

        .admin-link:hover {
            color: rgba(255,255,255,0.90);
            background: rgba(255,255,255,0.10);
            filter: brightness(1.05);
            transform: translateX(-2px);
            text-decoration: none;
        }

    /* =========================
           BOTÕES DA HOME (amarelos + comportamento)
           ========================= */
    .btn-home {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 10px 16px;
        border-radius: 12px;
        font-weight: 800;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: filter 0.2s ease, transform 0.1s ease, background 0.2s ease, border-color 0.2s ease;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
    }

        .btn-home:hover,
        .btn-home:focus,
        .btn-home:active,
        .btn-home:visited {
            text-decoration: none;
            outline: none;
        }

    .btn-home--primary {
        background: rgba(255, 203, 0, 0.95);
        color: #0b0f17;
    }

        .btn-home--primary:hover {
            filter: brightness(1.05);
            transform: translateX(-2px);
            color: #0b0f17;
        }

        .btn-home--primary:active {
            transform: translateX(-1px) scale(0.99);
            filter: brightness(1.02);
            color: #0b0f17;
        }
</style>